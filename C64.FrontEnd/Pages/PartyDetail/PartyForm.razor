@namespace C64.FrontEnd.Pages
@using C64.FrontEnd.Validators;
<EditForm Model="Party" OnValidSubmit="OnDataAnnotationsValidated">
    <DataAnnotationsValidator />
    <ServerSideValidator @ref="serverSideValidator" />
    <div class="form-group">
        <label>
            Name
        </label>
        <div>
            <InputText class="form-control" @bind-Value="@Party.Name" />
            <ValidationMessage For="@(() => Party.Name)" />
        </div>
    </div>
    <div class="form-group">
        <label>Description</label><button class="btn btn-xs btn-primary float-right" type="button" @onclick="(() => showMarkDown = !showMarkDown)">Toggle Preview</button>
        <div>
            @if (showMarkDown)
            {
                <div class="border border-secondary p-3">
                    <RenderMarkdown MarkdownContent="@Party.Description" />
                </div>
            }
            else
            {
                <InputTextArea rows="4" class="form-control" @bind-Value="@Party.Description" />
                <ValidationMessage For="@(() => Party.Description)" />
            }
        </div>
    </div>
    <div class="form-group">
        <label>From</label>
        <div>
            <InputDate @bind-Value="@Party.From" StartingYear="1982" EndingYear="DateTime.Now.Year+1" />
            <ValidationMessage For="@(() => Party.From)" />
        </div>
    </div>
    <div class="form-group">
        <label>To</label>
        <div>
            <InputDate @bind-Value="@Party.To" StartingYear="1982" EndingYear="DateTime.Now.Year+1" />
            <ValidationMessage For="@(() => Party.To)" />
        </div>
    </div>
    <div class="form-group">
        <label>
            Organizers
        </label>
        <div>
            <InputText class="form-control" @bind-Value="@Party.Organizers" />
            <ValidationMessage For="@(() => Party.Organizers)" />
        </div>
    </div>
    <div class="form-group">
        <label>
            Url
        </label>
        <div>
            <InputText class="form-control" @bind-Value="@Party.Url" />
            <ValidationMessage For="@(() => Party.Url)" />
        </div>
    </div>
    <div class="form-group">
        <label>
            Email
        </label>
        <div>
            <InputText class="form-control" @bind-Value="@Party.Email" />
            <ValidationMessage For="@(() => Party.Email)" />
        </div>
    </div>
    <div class="form-group">
        <label>
            Location
        </label>
        <div>
            <InputText class="form-control" @bind-Value="@Party.Location" />
            <ValidationMessage For="@(() => Party.Location)" />
        </div>
    </div>
    <div class="form-group">
        <label>Country:</label>
        <div>
            <InputSelect class="form-control" @bind-Value="@Party.CountryId">
                <option value="">Select Country:</option>
                @foreach (var country in Countries)
                {
                    <option value="@country.CountryId">@country.Name</option>
                }
            </InputSelect>
        </div>
    </div>
    <button class="btn btn-primary" type="submit">Add party</button>
</EditForm>

@code {

    [Parameter]
    public Party Party { get; set; }

    [Parameter]
    public EventCallback OnValidSubmit { get; set; }

    [Parameter]
    public IEnumerable<Country> Countries { get; set; } = new List<Country>();

    private ServerSideValidator serverSideValidator = new ServerSideValidator();

    private bool showMarkDown = false;

    private async Task OnDataAnnotationsValidated()
    {
        await OnValidSubmit.InvokeAsync(null);

    }
}