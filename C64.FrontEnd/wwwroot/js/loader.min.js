var Module=null,JSMESS;(function(n){function nt(t,i,f,c){function b(n){var t=new Image;return t.src=n,t}function ut(){it&&et.setSplashImage(it)}function at(t,f){return f.setTitle("Downloading game metadata..."),new n(function(s,c){var l=t("Game Metadata",gt(i),"document");l.then(function(n){return g=n,f.setTitle("Downloading game filelist..."),t("Game File List",ni(i),"document",!0)},function(){f.setTitle("Failed to download IA item metadata!");f.failed_loading=!0;c(1)}).then(function(n){return f.failed_loading?null:(lt=n,f.setTitle("Downloading emulator metadata..."),p=g.getElementsByTagName("emulator").item(0).textContent,t("Emulator Metadata",dt(p),"text",!0))},function(){f.failed_loading||(f.setTitle("Failed to download file list!"),f.failed_loading=!0,c(2))}).then(function(t){var e,c,s;if(f.failed_loading)return null;if(w=JSON.parse(t),p&&p.indexOf("dosbox")===0)it=tt.dosbox,a=h,e=yt;else if(p&&p.indexOf("sae-")===0)it=tt.sae,a=o,e=bt;else if(p&&p.indexOf("pce-")===0)it=tt.pce,a=v,e=kt;else if(p&&p.indexOf("vice")===0)it=tt.vice,a=r,e=pt;else if(p)it=tt.mame,a=u,e=wt;else throw new Error("Unknown module type "+p+"; cannot configure the emulator.");if(c=w.wasm_filename&&"WebAssembly"in window,s=w.native_resolution,nt=[a.emulatorJS(ft(c?w.wasmjs_filename:w.js_filename)),a.emulatorWASM(c&&ft(w.wasm_filename)),a.locateAdditionalEmulatorJS(vt),a.fileSystemKey(i),a.nativeResolution(s[0],s[1]),a.aspectRatio(s[0]/s[1]),a.sampleRate(ct)],"keepAspect"in a&&a.keepAspect(w.keepAspect),/archive\.org$/.test(document.location.hostname)&&a.muted(!(typeof $!="undefined"&&$.cookie&&$.cookie("unmute"))),p&&p.indexOf("dosbox")===0)nt.push(a.startExe(g.getElementsByTagName("emulator_start").item(0).textContent));else if(p&&p.indexOf("vice")===0){let t=g.getElementsByTagName("emulator_start").item(0),i=[g.getElementsByTagName("vice_drive_8_fliplist").item(0),g.getElementsByTagName("vice_drive_9_fliplist").item(0),g.getElementsByTagName("vice_drive_10_fliplist").item(0),g.getElementsByTagName("vice_drive_11_fliplist").item(0)];t&&nt.push(a.autoLoad(t.textContent));let n=[];i.forEach(function(t){t?n.push(t.textContent.split(";")):n.push(null)});nt.push(a.fliplist(n));nt.push(a.extraArgs(w.extra_args))}else p&&p.indexOf("sae-")===0?nt.push(a.model(w.driver),a.rom(w.bios_filenames)):p&&p.indexOf("pce-")===0?nt.push(a.model(w.driver)):p&&nt.push(a.driver(w.driver),a.extraArgs(w.extra_args));return f.setTitle("Downloading game data..."),n.all(e(a,g,w,lt))},function(){f.failed_loading||(f.setTitle("Failed to download emulator metadata!"),f.failed_loading=!0,c(2))}).then(function(n){f.failed_loading||(ut(),s(a.apply(null,e(nt,n))))},function(){f.failed_loading||(f.setTitle("Failed to configure emulator!"),f.failed_loading=!0,c(3))})})}function vt(n){return"file_locations"in w&&n in w.file_locations?ft(w.file_locations[n]):ft(n)}function yt(n,t,r,u){var c="c",f={},e=[],o=s(t),h,a;return i&&i.endsWith(".zip")&&(f[c]=i),l(u,o.emulator_ext).forEach(function(n){f[c]=n.name}),y(o,/^dosbox_drive_([a-zA-Z])$/).forEach(function(n){let t=n[0],i=n[1];f[i[1]]=o[t]}),h=Object.keys(f),a=h.length,h.forEach(function(t,r){var o="Game File ("+(r+1)+" of "+a+")",u=f[t],s=u.includes("/")?k(u):k(u,rt(i));u.toLowerCase().endsWith(".zip")?e.push(n.mountZip(t,n.fetchFile(o,s))):e.push(n.mountFile("/"+u,n.fetchFile(o,s)))}),e}function pt(n,t,r,u){var c={},f=[],e=[],o=s(t),h;return l(u,o.emulator_ext).forEach(function(n){e.push(n.name)}),y(o,/^vice_drive_([89])$/).forEach(function(n){let t=n[0],i=n[1];c[i[1]]=o[t]}),h=e.length,e.forEach(function(t,r){var e="Game File ("+(r+1)+" of "+h+")",u=t,o=u.includes("/")?k(u):k(u,rt(i));u.toLowerCase().endsWith(".zip")&&!1?f.push(n.mountZip("",n.fetchFile(e,o))):f.push(n.mountFile("/"+u,n.fetchFile(e,o)))}),f}function wt(n,t,r,u){var f=[],a=r.bios_filenames,c,v;a.forEach(function(t,i){if(t){var r="Bios File ("+(i+1)+" of "+a.length+")";f.push(n.mountFile("/"+t,n.fetchFile(r,st(t))))}});var e=s(t),o={},h={};return l(u,e.emulator_ext).forEach(function(n,t){h[n.name]=1;r.peripherals&&r.peripherals[t]&&(o[r.peripherals[t]]=n.name)}),y(e,/^mame_peripheral_([a-zA-Z0-9]+)$/).forEach(function(n){let t=n[0],i=n[1];o[i[1]]=e[t];h[e[t]]=1}),c=Object.keys(h),v=c.length,c.forEach(function(t,r){var u="Game File ("+(r+1)+" of "+v+")",e=t.includes("/")?k(t):k(t,rt(i));f.push(n.mountFile("/"+t,n.fetchFile(u,e)))}),Object.keys(o).forEach(function(t){f.push(n.peripheral(t,o[t]))}),f.push(n.mountFile("/"+r.driver+".cfg",n.fetchOptionalFile("CFG File",ot(p)))),f}function bt(n,t,r,u){var f=[],o=r.bios_filenames,h,e;return o.forEach(function(t,i){if(t){var r="Bios File ("+(i+1)+" of "+o.length+")";f.push(n.mountFile("/"+t,n.fetchFile(r,st(t))))}}),h=s(t),e=l(u,h.emulator_ext),e.forEach(function(t,r){if(t){var u="Game File ("+(r+1)+" of "+e.length+")",o=t.name.includes("/")?k(t.name):k(t.name,rt(i));f.push(n.mountFile("/"+t.name,n.fetchFile(u,o)));f.push(n.floppy(0,t.name))}}),f.push(n.mountFile("/"+r.driver+".cfg",n.fetchOptionalFile("Config File",ot(p)))),f}function kt(n,t,r,u){var e=[],c=r.bios_filenames,o,f,h,a;return c.forEach(function(t,i){if(t){var r="ROM File ("+(i+1)+" of "+c.length+")";e.push(n.mountFile("/"+t,n.fetchFile(r,st(t))))}}),o=s(t),f={},l(u,o.emulator_ext).forEach(function(n,t){r.peripherals&&r.peripherals[t]&&(f[n.name]=r.peripherals[t])}),y(o,/^pce_drive_([a-zA-Z0-9]+)$/).forEach(function(n){var t=n[0],i=n[1][1];f[o[t]]=i}),h=Object.keys(f),a=h.length,h.forEach(function(t,r){var u="Game File ("+(r+1)+" of "+a+")",o=t.match(/\.([^.]*)$/)[1],s=t.includes("/")?k(t):k(t,rt(i));e.push(n.mountFile("/"+f[t]+"."+o,n.fetchFile(u,s)))}),e.push(n.mountFile("/pce-"+r.driver+".cfg",n.fetchOptionalFile("Config File",ot("pce-"+r.driver)))),e}var ht,tt,ct,g,lt,p,w,nt,it,et,a;typeof i!="string"&&(i=i.toString());f&&typeof f=="object"?typeof f.before_emulator=="function"?(ht=f.before_emulator,f.before_emulator=function(){ut();ht()}):f.before_emulator=ut:f={before_emulator:ut,before_run:f};tt=/archive\.org$/.test(document.location.hostname)?{ia:b("/images/ialogo.png"),mame:b("/images/mame.png"),mess:b("/images/mame.png"),dosbox:b("/images/dosbox.png"),sae:b("/images/sae.png"),pce:b("/images/pce.png"),vice:b("/images/vice.svg")}:{ia:b("other_logos/ia-logo-150x150.png"),mame:b("other_logos/mame.png"),mess:b("other_logos/mame.png"),dosbox:b("other_logos/dosbox.png"),sae:b("other_logos/sae.png"),pce:b("other_logos/pce.png"),vice:b("other_logos/vice.svg")};ct=function(){var n=window.AudioContext||window.webkitAudioContext||!1,t;return n?(t=new n,t.sampleRate.toString()):!1}();et=new d(t).setScale(c).setSplashImage(tt.ia).setLoad(at).setCallbacks(f);var rt=function(n){return n.split("/").shift()},ti=function(n){return n.split("/").pop()},dt=function(n){return"//cors.archive.org/cors/emularity_engine_v1/"+n+".json"},ot=function(n){return"//cors.archive.org/cors/emularity_config_v1/"+n+".cfg"},gt=function(n){var t=n.split("/");return"//cors.archive.org/cors/"+t[0]+"/"+t[0]+"_meta.xml"},ni=function(n){var t=n.split("/");return"//cors.archive.org/cors/"+t[0]+"/"+t[0]+"_files.xml"},k=function(n,t){return t?"//cors.archive.org/cors/"+t+"/"+n:"//cors.archive.org/cors/"+n},ft=function(n){return"//cors.archive.org/cors/emularity_engine_v1/"+n},st=function(n){return"//cors.archive.org/cors/emularity_bios_v1/"+n};return et}function t(){return Array.prototype.reduce.call(arguments,e)}function h(){var n=Array.prototype.reduce.call(arguments,e);return n.emulator_arguments=b(n.emulatorStart,n.files,n.extra_dosbox_args),n.runner=i,n}function a(){var n=Array.prototype.reduce.call(arguments,e);return n.emulator_arguments=b(n.emulatorStart,n.files,n.extra_dosbox_args),n.runner=p,n}function u(){var n=Array.prototype.reduce.call(arguments,e);return n.emulator_arguments=tt(n.muted,n.mame_driver,n.nativeResolution,n.sample_rate,n.peripheral,n.extra_mame_args,n.keep_aspect),n.runner=k,n}function r(){var n=Array.prototype.reduce.call(arguments,e);return n.fliplist&&r._create_fliplist_file(n.files,n.fliplist),n.emulator_arguments=it(n.emulatorStart,n.files,n.fliplist,n.extra_vice_args),n.runner=i,n}function o(){var n=Array.prototype.reduce.call(arguments,e);return n.runner=f,n}function v(){var n=Array.prototype.reduce.call(arguments,e);return n.emulator_arguments=["-c","/emulator/pce-"+n.pceModel+".cfg"],n.runner=i,n}function i(n,t){var i=this;this._hooks={start:[],reset:[]};Module={arguments:t.emulator_arguments,screenIsReadOnly:!0,print:function(n){console.log(n)},printErr:function(n){console.log(n)},canvas:n,noInitialRun:!1,locateFile:t.locateAdditionalJS,wasmBinary:t.wasmBinary,preInit:function(){BrowserFS.initialize(t.fs);var n=new BrowserFS.EmscriptenFS;FS.mkdir("/emulator");FS.mount(n,{root:"/"},"/emulator")},preRun:[function(){i._hooks.start.forEach(function(n){n&&n()})}]}}function p(){return i.apply(this,arguments)}function k(){return i.apply(this,arguments)}function f(n,t){var i,r;this._sae=new ScriptedAmigaEmulator;this._cfg=this._sae.getConfig();this._canvas=n;i=null;switch(t.amigaModel){case"A500":i=SAEC_Model_A500;break;case"A500P":i=SAEC_Model_A500P;break;case"A600":i=SAEC_Model_A600;break;case"A1000":i=SAEC_Model_A1000;break;case"A1200":i=SAEC_Model_A1200;break;case"A2000":i=SAEC_Model_A2000;break;case"A3000":i=SAEC_Model_A3000;break;case"A4000":i=SAEC_Model_A4000;break;case"A4000T":i=SAEC_Model_A4000T}for(this._sae.setModel(i,0),this._cfg.memory.z2FastSize=t.fastMemory||2097152,this._cfg.floppy.speed=SAEC_Config_Floppy_Speed_Turbo,this._cfg.video.id=n.getAttribute("id"),t.nativeResolution&&t.nativeResolution.height==360&&t.nativeResolution.width==284?(this._cfg.video.hresolution=SAEC_Config_Video_HResolution_LoRes,this._cfg.video.vresolution=SAEC_Config_Video_VResolution_NonDouble,this._cfg.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH,this._cfg.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT):t.nativeResolution&&t.nativeResolution.height==1440&&t.nativeResolution.width==568?(this._cfg.video.hresolution=SAEC_Config_Video_HResolution_SuperHiRes,this._cfg.video.vresolution=SAEC_Config_Video_VResolution_Double,this._cfg.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH<<2,this._cfg.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT<<1):(this._cfg.video.hresolution=SAEC_Config_Video_HResolution_HiRes,this._cfg.video.vresolution=SAEC_Config_Video_VResolution_Double,this._cfg.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH<<1,this._cfg.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT<<1),this._cfg.memory.rom.name=t.rom,this._cfg.memory.rom.data=t.fs.readFileSync("/"+t.rom,null,c),this._cfg.memory.rom.size=this._cfg.memory.rom.data.length,t.extRom&&(this._cfg.memory.extRom.name=t.extRom,this._cfg.memory.extRom.data=t.fs.readFileSync("/"+t.extRom,null,c),this._cfg.memory.extRom.size=this._cfg.memory.extRom.data.length),r=0;r<Object.keys(t.floppy).length;r++)this._cfg.floppy.drive[r].file.name=t.floppy[r],this._cfg.floppy.drive[r].file.data=t.fs.readFileSync("/"+t.floppy[r],null,c),this._cfg.floppy.drive[r].file.size=this._cfg.floppy.drive[r].file.data.length}function d(t,r,u){function ft(n){return function(t){t.which==32&&(t.preventDefault(),n())}}function ot(n,t,i){t.splashElt=document.getElementById("emularity-splash-screen");t.splashElt||(t.splashElt=document.createElement("div"),t.splashElt.classList.add("emularity-splash-screen"),i.hasCustomCSS||(t.splashElt.style.top="0",t.splashElt.style.left="0",t.splashElt.style.right="0",t.splashElt.style.color=t.getColor("foreground"),t.splashElt.style.backgroundColor=t.getColor("background")),n.parentElement.appendChild(t.splashElt));t.splashimg.classList.add("emularity-splash-image");i.hasCustomCSS||(t.splashimg.style.display="block",t.splashimg.style.marginLeft="auto",t.splashimg.style.marginRight="auto");t.splashElt.appendChild(t.splashimg);t.titleElt=document.createElement("span");t.titleElt.classList.add("emularity-splash-title");i.hasCustomCSS||(t.titleElt.style.display="block",t.titleElt.style.width="100%",t.titleElt.style.marginTop="1em",t.titleElt.style.marginBottom="1em",t.titleElt.style.textAlign="center",t.titleElt.style.font="24px sans-serif");t.titleElt.textContent=" ";t.splashElt.appendChild(t.titleElt);var r=document.getElementById("emularity-progress-indicator");r||(r=document.createElement("table"),r.classList.add("emularity-progress-indicator"),r.dataset.hasCustomCSS=i.hasCustomCSS,i.hasCustomCSS||(r.style.width="75%",r.style.color=t.getColor("foreground"),r.style.backgroundColor=t.getColor("background"),r.style.marginLeft="auto",r.style.marginRight="auto",r.style.borderCollapse="separate",r.style.borderSpacing="2px"),t.splashElt.appendChild(r));t.table=r}function st(t){return new n(function(n,i){function u(t){t.target==r&&(r.removeEventListener("load",u),r.removeEventListener("error",f),n())}function f(n){n.target==r&&(r.removeEventListener("load",u),r.removeEventListener("error",f),i())}var r,e;t&&(e=document.getElementsByTagName("head")[0],r=document.createElement("script"),r.addEventListener("load",u),r.addEventListener("error",f),r.type="text/javascript",r.src=t,e.appendChild(r))})}function ht(){return t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock}function ct(){var i=this,n=function(){document.mozFullScreenElement||document.fullScreenElement||l(t,p,y,b)};"onfullscreenchange"in document?document.addEventListener("fullscreenchange",n):"onmozfullscreenchange"in document?document.addEventListener("mozfullscreenchange",n):"onwebkitfullscreenchange"in document&&document.addEventListener("webkitfullscreenchange",n)}function lt(){function n(n){return n.which>=33&&n.which<=40?(n.preventDefault(),!1):!0}window.onkeydown=n}function at(n){n.addEventListener("contextmenu",function(n){n.button==2&&n.preventDefault()})}var y,p,b,h,k,l,et,nt,tt;typeof r!="object"&&(r={before_emulator:null,before_run:r});var a=!1,v={foreground:"white",background:"black",failure:"red"},f={loading_text:"",spinning:!0,finished_loading:!1,colors:v,table:null,splashimg:new Image},e,o=!1,s;this.isMuted=function(){return o};this.mute=function(){return this.setMute(!0)};this.unmute=function(){return this.setMute(!1)};this.toggleMute=function(){return this.setMute(!o)};this.setMute=function(n){if(o=n,e)n?e.mute():e.unmute();else try{s||(s=Module.cwrap("SDL_PauseAudio","",["number"]));s(n)}catch(t){console.log("Unable to change audio state:",t)}return this};window.addEventListener("gamepadconnected",function(n){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",n.gamepad.index,n.gamepad.id,n.gamepad.buttons.length,n.gamepad.axes.length)});window.addEventListener("gamepaddisconnected",function(n){console.log("Gamepad disconnected from index %d: %s",n.gamepad.index,n.gamepad.id)});/archive\.org$/.test(document.location.hostname)&&document.getElementById("gofullscreen")&&document.getElementById("gofullscreen").addEventListener("click",this.requestFullScreen);t.hasAttribute("width")||(h=getComputedStyle(t),t.width=parseInt(h.width,10),t.height=parseInt(h.height,10));this.setScale=function(n){return p=n,this};this.setSplashImage=function(n){return n&&(n instanceof Image?f.splashimg.parentNode?f.splashimg.src=n.src:f.splashimg=n:f.splashimg.src=n),this};this.setCSSResolution=function(n){return y=n,this};this.setAspectRatio=function(n){return b=n,this};this.setCallbacks=function(n){return r=typeof n!="object"?{before_emulator:null,before_run:n}:n,this};this.setSplashColors=function(n){return f.colors=n,this};this.setLoad=function(n){return u=n,this};k=function(s){function b(){var n=new h.runner(t,h);l(t,1,h.nativeResolution,h.aspectRatio);n.onStarted(function(){f.finished_loading=!0;f.hide();r&&r.before_run&&setTimeout(function(){r.before_run()},0)});n.onReset(function(){o&&n.mute()});return n}var v,y,c,h,p;return a?!1:(a=!0,v={waitAfterDownloading:!1,hasCustomCSS:!1},typeof s!="object"?s=v:s.__proto__=v,ot(t,f,s),tt(),p=typeof u=="function"?u(d,f):n.resolve(u),p.then(function(t){return new n(function(i,r){function u(){h=t;h.fs=new BrowserFS.FileSystem.OverlayFS(deltaFS,new BrowserFS.FileSystem.MountableFileSystem);h.fs.initialize(function(t){var u,f;if(t)console.error("Failed to initialize the OverlayFS:",t),r();else{u=BrowserFS.BFSRequire("buffer").Buffer;function t(t){return"data"in t&&t.data!==null&&typeof t.data!="undefined"?n.resolve(t.data):d(t.title,t.url,"arraybuffer",t.optional)}function e(n){return function(t){if(t!==null){n=n.toLowerCase();var i="/"+n;h.fs.getOverlayedFileSystems().readable.mount(i,rt(new u(t)))}}}function o(n){return function(t){var r,i,f;if(t!==null){if(n.includes("/"))for(r=n.split("/"),i=1;i<r.length;i++)f="/"+r.slice(0,i).join("/"),h.fs.existsSync(f)||h.fs.mkdirSync(f);h.fs.writeFileSync("/"+n,new u(t),null,w,420)}}}f=h.files.map(function(n){if(n&&n.file){if(n.drive)return t(n.file).then(e(n.drive));if(n.mountpoint)return t(n.file).then(o(n.mountpoint))}return null});"emulatorWASM"in h&&h.emulatorWASM&&"WebAssembly"in window&&f.push(t({title:"WASM Binary",url:h.emulatorWASM}).then(function(n){h.wasmBinary=n}));n.all(f).then(i,r)}})}var f=new BrowserFS.FileSystem.InMemory,e,o;BrowserFS.FileSystem.IndexedDB.isAvailable()?(e=BrowserFS.FileSystem.AsyncMirror,o=BrowserFS.FileSystem.IndexedDB,deltaFS=new e(f,new o(function(n){n?(deltaFS=f,u()):deltaFS.initialize(function(n){n?r(n):u()})},"fileSystemKey"in t?t.fileSystemKey:"emularity"))):u()})}).then(function(){return!h||f.failed_loading?null:s.waitAfterDownloading?new n(function(n){f.setTitle("Press any key to continue...");f.spinning=!1;window.addEventListener("keypress",y=ft(n));t.addEventListener("click",c=n);f.splashElt.addEventListener("click",c)}):n.resolve()},function(){f.failed_loading||(f.setTitle("Failed to download game data!"),f.failed_loading=!0)}).then(function(){if(!h||f.failed_loading)return null;if(f.spinning=!0,window.removeEventListener("keypress",y),t.removeEventListener("click",c),f.splashElt.removeEventListener("click",c),lt(),ct(),at(t),t.requestPointerLock=ht(),ut(h.fs),r&&r.before_emulator)try{r.before_emulator()}catch(n){console.log(n)}return("runner"in h&&(h.runner==i||h.runner.prototype instanceof i)&&(e=b()),h.emulatorJS)?(f.setTitle("Launching Emulator"),st(h.emulatorJS)):(f.setTitle("Non-system disk or disk error"),null)},function(){if(!h||f.failed_loading)return null;f.setTitle("Invalid media, track 0 bad or unusable");f.failed_loading=!0}).then(function(){if(!h||f.failed_loading)return null;"runner"in h&&(e||(e=b()),e.start())}),this)};this.start=k;var it=function(n){return n.lengthComputable?"("+(n.total?(n.loaded/n.total*100).toFixed(0):"100")+"%; "+c(n.loaded)+" of "+c(n.total)+")":"("+c(n.loaded)+")"},c=function(n,t){if(n===0)return"0 B";var i=t?1e3:1024,u=t?["B","kB","MB","GB","TB","PB","EB","ZB","YB"]:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=parseInt(Math.log(n)/Math.log(i)),f=n/Math.pow(i,r);return f.toFixed(1)+" "+u[r]},d=function(t,i,r,u){var o=f.table.dataset.hasCustomCSS=="false",s=nt(f.table),e=s[0],h=s[1];return e.textContent=t,new n(function(n,s){function l(){h.textContent="✔";e.parentNode.classList.add("emularity-download-success");e.textContent=t;o&&(e.style.fontWeight="bold",e.parentNode.style.backgroundColor=f.getColor("foreground"),e.parentNode.style.color=f.getColor("background"))}function a(){h.textContent="✘";e.parentNode.classList.add("emularity-download-failure");e.textContent=t;o&&(e.style.fontWeight="bold",e.parentNode.style.backgroundColor=f.getColor("failure"),e.parentNode.style.color=f.getColor("background"))}var c=new XMLHttpRequest;c.open("GET",i,!0);c.responseType=r||"arraybuffer";c.onprogress=function(n){e.innerHTML=t+' <span style="font-size: smaller">'+it(n)+"<\/span>"};c.onload=function(){c.status===200?(l(),n(c.response)):u?(l(),n(null)):(a(),s())};c.onerror=function(){u?(l(),n(null)):(a(),s())};c.send()})};l=function(n,t,i){t&&i&&(n.style.imageRendering="-moz-crisp-edges",n.style.imageRendering="-o-crisp-edges",n.style.imageRendering="-webkit-optimize-contrast",n.style.imageRendering="optimize-contrast",n.style.imageRendering="crisp-edges",n.style.imageRendering="pixelated",n.style.imageRendering="optimizeSpeed",n.style.width=i.width*t+"px",n.style.height=i.height*t+"px",n.width=i.width,n.height=i.height)};et=function(){var n=t.getContext("2d");n.fillStyle=f.getColor("background");n.fillRect(0,0,t.width,t.height);console.log("canvas cleared")};f.setTitle=function(n){f.titleElt.textContent=n};f.hide=function(){f.splashElt.style.display="none"};f.getColor=function(n){return n in f.colors?f.colors[n]:v[n]};nt=function(n){var r=n.dataset.hasCustomCSS=="false",f=n.insertRow(-1),u,t,i;return r&&(f.style.textAlign="center"),u=f.insertCell(-1),r&&(u.style.position="relative"),t=document.createElement("span"),t.classList.add("emularity-download-title"),t.textContent="—",r&&(t.style.verticalAlign="center",t.style.minHeight="24px",t.style.whiteSpace="nowrap"),u.appendChild(t),i=document.createElement("span"),i.classList.add("emularity-download-status"),r&&(i.style.position="absolute",i.style.left="0",i.style.paddingLeft="0.5em"),u.appendChild(i),[t,i]};tt=function(){t.setAttribute("moz-opaque","");f.splashimg.src||(f.splashimg.src="/images/vicelogo.png")};this.isfullscreensupported=function(){return!!g()};this.requestFullScreen=function(){typeof Module=="object"&&"requestFullScreen"in Module?Module.requestFullScreen(1,0):e&&e.requestFullScreen()}}function g(){return canvas.requestFullScreen||canvas.webkitRequestFullScreen||canvas.mozRequestFullScreen}function rt(n){return new BrowserFS.FileSystem.ZipFS(n)}function ut(n){function i(r){n.readdirSync(r).forEach(function(u){if(!t&&u!=="."&&u!==".."){var f=r+(r[r.length-1]!=="/"?"/":"")+u,e=n.statSync(f);e.isDirectory(e.mode)?i(f):u==="dosbox.conf"&&(t=f)}})}var t=null;i("/");t!==null&&n.writeFileSync("/dosbox.conf",n.readFileSync(t,null,c),null,w,420)}function e(n,t){if(n===null)return t;if(t===null)return n;var i=typeof n,r=typeof t;if(i!==r){if(i==="undefined")return t;if(r==="undefined")return n;throw new Error("Cannot extend an "+i+" with an "+r);}return Array.isArray(n)?n.concat(t):i==="object"?(Object.keys(t).forEach(function(i){n[i]=e(i in n?n[i]:undefined,t[i])}),n):t}function s(n){var i,u,t,r;for(n instanceof XMLDocument&&(n=n.documentElement),i={},u=n.childNodes.length,t=0;t<u;t++)r=n.childNodes[t],i[r.nodeName]=r.textContent;return i}function ft(n){return n instanceof XMLDocument&&(n=n.documentElement),Array.prototype.slice.call(n.childNodes)}function et(n){return ft(n).filter(function(n){return"getAttribute"in n}).map(function(n){var t=s(n);return t.name=n.getAttribute("name"),t})}function l(n,t){return t?(t.startsWith(".")||(t="."+t),t=t.toLowerCase(),et(n).filter(function(n){return n.name.toLowerCase().endsWith(t)})):[]}function y(n,t){return typeof t=="string"&&(t=RegExp(t)),Object.keys(n).map(function(n){let i=t.exec(n);return i?[n,i]:null}).filter(function(n){return!!n})}function ot(n,t,i,r,u,f,e,o,s){for(var a=SDL.makeSurface(t,i,0,!1,"CreateRGBSurfaceFrom",f,e,o,s),v=SDL.surfaces[a],y=v.ctx.getImageData(0,0,t,i),c=y.data,l=s?4:3,h=0;h<t*i;h++)c[h*4+0]=HEAPU8[n+(h*l+0)],c[h*4+1]=HEAPU8[n+(h*l+1)],c[h*4+2]=HEAPU8[n+(h*l+2)],c[h*4+3]=s?HEAPU8[n+(h*l+3)]:255;return v.ctx.putImageData(y,0,0),a}var c,w;t.canvas=function(n){var t=n instanceof Element?n:document.getElementById(n);return{canvas:t}};t.emulatorJS=function(n){return{emulatorJS:n}};t.emulatorWASM=function(n){return{emulatorWASM:n}};t.locateAdditionalEmulatorJS=function(n){return{locateAdditionalJS:n}};t.fileSystemKey=function(n){return{fileSystemKey:n}};t.nativeResolution=function(n,t){if(typeof n!="number"||typeof t!="number")throw new Error("Width and height must be numbers");return{nativeResolution:{width:Math.floor(n),height:Math.floor(t)}}};t.aspectRatio=function(n){if(typeof n!="number")throw new Error("Aspect ratio must be a number");return{aspectRatio:n}};t.sampleRate=function(n){return{sample_rate:n}};t.muted=function(n){return{muted:n}};t.mountZip=function(n,t){return{files:[{drive:n,mountpoint:"/"+n,file:t}]}};t.mountFile=function(n,t){return{files:[{mountpoint:n,file:t}]}};t.fetchFile=function(n,t){return{title:n,url:t,optional:!1}};t.fetchOptionalFile=function(n,t){return{title:n,url:t,optional:!0}};t.localFile=function(n,t){return{title:n,data:t}};h.__proto__=t;h.startExe=function(n){return{emulatorStart:n}};h.extraArgs=function(n){return{extra_dosbox_args:n}};a.__proto__=t;a.startExe=function(n){return{emulatorStart:n}};a.extraArgs=function(n){return{extra_dosbox_args:n}};u.__proto__=t;u.driver=function(n){return{mame_driver:n}};u.peripheral=function(n,t){var i={};return i[n]=[t],{peripheral:i}};u.keepAspect=function(n){return{keep_aspect:!!n}};u.extraArgs=function(n){return{extra_mame_args:n}};r.__proto__=t;r.autoLoad=function(n){return{emulatorStart:n}};r.extraArgs=function(n){return{extra_vice_args:n}};r.fliplist=function(n){return{fliplist:n}};r._create_fliplist_file=function(n,t){let i="# Vice fliplist file\n\n";t.forEach(function(n,t){n&&(n=n.reverse(),i+="UNIT "+(t+8).toString()+"\n",n.forEach(function(n){i+="/emulator/"+n+"\n"}))});n.push(r.mountFile("/metadata_fliplist.vfl",r.localFile("Fliplist",i)).files[0])};o.__proto__=t;o.model=function(n){return{amigaModel:n}};o.fastMemory=function(n){return{fast_memory:n<<20}};o.rom=function(n){return typeof n=="string"&&(n=[n]),{rom:n[0],extRom:n[1]}};o.floppy=function(n,t){var i={};return i[n]=t,{floppy:i}};o.ntsc=function(n){return{ntsc:!!n}};v.__proto__=t;v.model=function(n){return{pceModel:n}};var tt=function(n,t,i,r,u,f,e){var o=[t,"-verbose","-rompath","emulator","-window",e?"-keepaspect":"-nokeepaspect"],s;if(i&&"width"in i&&"height"in i&&o.push("-resolution",[i.width,i.height].join("x")),n?o.push("-sound","none"):r&&o.push("-samplerate",r),u)for(s in u)Object.prototype.propertyIsEnumerable.call(u,s)&&o.push("-"+s,"/emulator/"+u[s][0].replace(/\//g,"_"));return f&&(o=o.concat(f)),o},b=function(n,t,i){for(var u,e,r=["-conf","/emulator/dosbox.conf"],o=t.length,f=0;f<o;f++)"drive"in t[f]&&r.push("-c","mount "+t[f].drive+" /emulator"+t[f].mountpoint);return i&&(r=r.concat(i)),u=n.split(/\\|\//),r.push("-c",/^[a-zA-Z]:$/.test(u[0])?u.shift():"c:"),e=u.pop(),u&&u.length&&r.push("-c","cd "+u.join("/")),r.push("-c",e),r},it=function(n,t,i,r){var u=n?["-autostart","/emulator/"+n]:[];return(i[0]||i[1]||i[2]||i[3])&&(u=u.concat(["-flipname","/emulator/metadata_fliplist.vfl"])),r&&(u=u.concat(r)),u};i.prototype.start=function(){};i.prototype.pause=function(){};i.prototype.stop=function(){};i.prototype.mute=function(){try{SDL_PauseAudio||(SDL_PauseAudio=Module.cwrap("SDL_PauseAudio","",["number"]));SDL_PauseAudio(!0)}catch(n){console.log("Unable to change audio state:",n)}};i.prototype.unmute=function(){try{SDL_PauseAudio||(SDL_PauseAudio=Module.cwrap("SDL_PauseAudio","",["number"]));SDL_PauseAudio(!1)}catch(n){console.log("Unable to change audio state:",n)}};i.prototype.onStarted=function(n){this._hooks.start.push(n)};i.prototype.onReset=function(n){this._hooks.reset.push(n)};i.prototype.requestFullScreen=function(){};p.prototype=Object.create(i.prototype);p.prototype.start=function(){FS.symlink("/emulator/y/FONT.ROM","/FONT.ROM");FS.symlink("/emulator/y/2608_bd.wav","/2608_bd.wav");FS.symlink("/emulator/y/2608_hh.wav","/2608_hh.wav");FS.symlink("/emulator/y/2608_sd.wav","/2608_sd.wav");FS.symlink("/emulator/y/2608_rim.wav","/2608_rim.wav");FS.symlink("/emulator/y/2608_tom.wav","/2608_tom.wav");FS.symlink("/emulator/y/2608_top.wav","/2608_top.wav")};k.prototype=Object.create(i.prototype,{mute:function(){var n=Module.__ZN15running_machine20emscripten_get_soundEv(Module.__ZN15running_machine30emscripten_get_running_machineEv());Module.__ZN13sound_manager4muteEbh(n,!0,2)},unmute:function(){var n=Module.__ZN15running_machine20emscripten_get_soundEv(Module.__ZN15running_machine30emscripten_get_running_machineEv());Module.__ZN13sound_manager4muteEbh(n,!1,2)}});f.prototype.start=function(){var n=this._sae.start()};f.prototype.pause=function(){this._sae.pause()};f.prototype.stop=function(){this._sae.stop()};f.prototype.mute=function(){var n=this._sae.mute(!0);n&&console.warn("unable to mute; SAE error number",n)};f.prototype.unmute=function(){var n=this._sae.mute(!1);n&&console.warn("unable to unmute; SAE error number",n)};f.prototype.onStarted=function(n){this._cfg.hook.event.started=n};f.prototype.onReset=function(n){this._cfg.hook.event.reseted=n};f.prototype.requestFullScreen=function(){g().call(this._canvas)};c={isReadable:function(){return!0},isWriteable:function(){return!1},isTruncating:function(){return!1},isAppendable:function(){return!1},isSynchronous:function(){return!1},isExclusive:function(){return!1},pathExistsAction:function(){return 0},pathNotExistsAction:function(){return 1}};w={isReadable:function(){return!1},isWriteable:function(){return!0},isTruncating:function(){return!1},isAppendable:function(){return!1},isSynchronous:function(){return!1},isExclusive:function(){return!1},pathExistsAction:function(){return 0},pathNotExistsAction:function(){return 3}};window.IALoader=nt;window.DosBoxLoader=h;window.PC98DosBoxLoader=a;window.JSMESSLoader=u;window.JSMAMELoader=u;window.MAMELoader=u;window.SAELoader=o;window.PCELoader=v;window.VICELoader=r;window.Emulator=d;window._SDL_CreateRGBSurfaceFrom=ot})(typeof Promise=="undefined"?ES6Promise.Promise:Promise);JSMESS=JSMESS||{};JSMESS.ready=function(n){n()};